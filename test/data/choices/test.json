[
  {
    name: "root",
    intro: [{ switch: [{test:"!$c.day",case:{ text: "Here we are, {{$n2}} and {{$n1}}: the first day of school." }},
		       {test:"$c.day == 1",case:{ text: "Here we are, {{$n2}} and {{$n1}}: the second day of school." }},
		       {default:{ text: "Here we are, {{$n2}} and {{$n1}}: day {{($c.day||0)+1}} of school." }}] },
	    {
	      text: "$other suggests skipping class. ",
	      prepend: true
	    },
	    { text: "Do you want to play truant, or rat them out{{$c.iceCream && ' (remember the ice cream)'}}?",
	      left: {
		hint: "Rat them out",
		label: { move: "l" },
		sequence: [{ text: "You decide to rat them out." },
			   { ref: "low" },  // cross-reference to Text table
			   { text: "++\nJust saying." }]  // this will be concatenated with the previous node
	      },
	      right: {
		hint: "Skip class",
		label: { move: "r" }
	      }
	    }],
    rr: [{weight: "$c.iceCream",
	  outro: [{ text: "Cool, let's skip class together!",
		    next: { role1: { text: "Party times, by the beach..." },
                            role2: { text: "Sunny day, by the beach..." },
			    next: { text: "Co-operation is great!" } } }],
	  global1:{count:{c:"$_+1||1"}},  // increments global1.count.c
          global2:{count:{c:"$_+1||1"}},  // this increments global2.count.c
          common:{day:"++"}},  // increments common.day
         {weight:"!$c.iceCream",
	  outro:[{ text: "Cool, let's skip class together!\n" },
		 { expr: { text: "'Shall we go to the beach,' + ' or to the mall?'" },
		   append: true,
                   left: { name: "mall",
			   hint: "Mall",
                           text: "You scuttle around like a couple of mall-rats exposed to shopping for the [[$ordinal($visits)]] time. Eventually you get bored, and decide to head for the beach.",
                           right: { hint: "OK", goto: "beach" },
			   left: { hint: "No! More mall!", usable: "$follows < 2", goto: "mall" } },
		   right: { name: "beach",
                            hint: "Beach",
                            text: "<mood:happy>Party times, by the beach...\n++",  // this will be concatenated with the next node
			    next: { text: "Co-operation is great!" } } }],
	  global1:{count:{c:"$_+1||1"}},  // increments global1.count.c
          global2:{count:{c:"$_+1||1"}},  // increments global2.count.c
          common:{day:"+=1"},  // increments common.day
          next: {intro: { text: "Want to have an ice cream together?",
			  left: { hint: "No",
				  text: "Why - because you don't like ice cream, or just don't feel like it today?",
				  left: { hint: "Don't like ice cream",
					  label: { move: "n" } },
				  right: { hint: "Don't feel like it",
					   label: { move: "n" } } },
			  right: { hint: "Yes",
				   label: { move: "y" } } },
                 outcome: [{ move1: "y",
			     move2: "y",
			     outro: {
                               text: "I love ice cream.\nYou love ice cream.\nWe all love ice cream! So much that I want to eat ice cream until I literally look like a giant cone.\n<icon:ice-cream-cone>",
			       next: { hint: "So true!",
				       sequence:
				       [{name: "choose_flavor",
					 text: "What flavor?[[$visits>1?(' ('+$ordinal($visits)+' try)'):'']]",
					 menu:
					 [{
		                           hint: 'Vanilla',
					   label: { flavor: 'vanilla' },
                                           text: 'Excellent choice!'
					 },
		                          {
		                            hint: 'Chocolate',
					    usable: "$follows < 2",
					    label: { flavor: 'chocolate' },
                                            text: "oh no you DIDN'T",
                                            next: {
                                              hint: "Try again",
                                              goto: 'choose_flavor'
                                            }
		                          },
		                          {
		                            hint: 'Strawberry',
					    visible: "!$label('flavor')",
					    label: { flavor: 'strawberry' },
                                            text: 'Good choice!'
		                          }] },
					{ text: "You chose: <label:flavor,&>" }]
				     }
                             },
			     common:{iceCream:true}},
                           { weight: "$1.move() != $2.move()",
			     outro: { text: "Unfortunately, not everybody loves ice cream. <mood{{$1.move()==='n'?2:1}}:surprised>" } },
                           { move1: "n",
                             move2: "n",
                             outro: "Right: ice cream sucks."
                           }]}}],
    lr2: {outro:"Well, it was a good plan; but $player1 ratted $player2 out.\nTruancy doesn't pay, if you can't trust your friends.;; <sfx:surprised><class:outcome>Sorry, $player2...",
          global1:{count:{c:"$_+1||1"}},
          local2:{count:{d:"$_+1||1"}},
          common:{day:"$_+1||1"},
	  next: {intro:{},
		 intro2: { text:"How do you feel about that?",
			   left: { hint: "Mad", label: { move: "l" } },
			   right: { hint: "OK", label: { move: "r" } } },
		 outcome: [{ move2: 'r',
			     outro: 'Guess $player2 is OK with it.' },
			   { move2: 'l',
			     next: { intro: {},
				     intro2: { text:"How mad?",
					       left: { hint: "Very", label: { move: "l" } },
					       right: { hint: "Kinda", label: { move: "r" } } },
				     outcome: [{ move2: 'r',
						 outro: '$player2 doesn\'t seem too happy...' },
					       { move2: 'l',
						 outro: '$player2 is fuming!' }]}}]}},
    ll: [{weight:"!($local1.count.d && $local2.count.d)",
          outro:"You and #{$no}# are a couple of goody two-shoes ;; Too bad!",
          local1:{count:{d:"$_+1||1"}},  // increments local1.count.d
          local2:{count:{d:"$_+1||1"}},  // increments local2.count.d
          next:"auto",
          common:{day:"++"}},  // increments common.day
         {weight:"$local1.count.d && $local2.count.d",
          outro: { text: "You both chicken out - AGAIN",
		   auto: true,
		   optimal: true,
		   menu: [{ visible: "false", text: "This text should not be auto-selected because it's not visible" },
			  { usable: "false", text: "This text should never appear because it's not usable" },
			  { weight: 0, text: "This text should not appear because it has weight 0" },
			  { default: false, text: "This should not get shown because it's not a default" },
			  { weight: 0.5, text: "This is valid but lower-weight so should not be shown" },
			  { visible: "true", usable: "true", text: "This keeps happening!" },  // this item and the following item are tied with equal weight (1) but this is the first and so it should be the one that gets selected
			  { visible: "true", text: "This is tied equal weight but appears later in the list and should not be shown" }] },
          local1:{count:{d:"+=1"}},  // yet another way of writing '++' or '$_+1||1'
          local2:{count:{d:"+=1"}},
          next:"auto",
          common:{day:"+=1"}}]
  },
  {
    name: "auto",
    auto: {next:["~root","~root"]}
  }
]
